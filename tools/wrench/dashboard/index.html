<!DOCTYPE html>
<html>
    <head>
        <script type='text/javascript' src='public/jquery-3.3.1.min.js'></script>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>WRENCH Dashboard</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="public/bootstrap.min.css"></script>
        <link rel="stylesheet" href="public/bootstrap.min.css">
        <link rel="stylesheet" href="public/styles.css">
        <link rel="icon" href="public/favicon.ico" />
        <script src="public/d3.min.js" type="text/javascript"></script>
        <script src="public/jQueryRotate.js" type="text/javascript"></script>
        <script src="public/d3-3d.js" type="text/javascript"></script>
        <!-- billboard.js scripts -->
        <script src="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/billboard.js/dist/billboard.min.css">
    </head>
    <body>
        <div id='info-container'>
            <div id='nav-bar-top-half'>
                <div id='logo-and-title'>
                    <img src='public/logo-vertical.png' id=logo>
                    <h3>WRENCH Dashboard</h3>
                </div>
                <div id='file-upload'>
                    <h5 id='file-upload-title'>Upload files here:</h5>
                    <div class='file-upload-container'>
                        <p class='file-upload-subtitle'>Workflow Data: </p>
                        <input type='file' accept='application/json' onchange='processFile(this.files, "taskData");'>
                    </div>
                    <div class='file-upload-container'>
                        <p class='file-upload-subtitle'>Energy Data: </p>
                        <input type='file' accept='application/json' onchange='processFile(this.files, "energy");'>
                    </div>
                </div>
            </div>
        </div>
        <div id="no-file">
            <h6>Please upload your JSON files in the file upload above</h6>
        </div>
        <div id="main-body">
            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("overall-metrics-table-container", "overall-metrics-arrow")'>
                    <h6 class='title-text'>Summary of Simulation Metrics</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='overall-metrics-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>
                
                <div class='hidden' id='overall-metrics-table-container'>
                    <table id='overall-metrics-table'>
                        <colgroup>
                            <col span="1" class='overall-metrics-table-col read-col'></col>
                            <col span="1" class='overall-metrics-table-col write-col'></col>
                        </colgroup>
                        <thead>
                            <tr>
                                <th class='task-details-table-td'>Metric</th>
                                <th class='task-details-table-td'>Value</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            
            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("overall-graph-container", "simulation-graph-arrow")'>
                    <h6 class='title-text'>Simulation Graph</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='simulation-graph-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>
                
                <div class='hidden' id='overall-graph-container'>
                    <div id='button-and-information-container'>
                        <button id='toggle-view-button' onclick="toggleView()">Switch to Host View</button>
                        <img id='information-img' class='information-img' src='public/information.png' onclick='showInstructions("host-instructions", "information-img")'/>
                    </div>
                    <div id='host-instructions' class='instructions-container'>
                        <div id='host-instructions-close-button-container' class='instructions-close-button-container'>
                            <img id='host-instructions-close-button' class='instructions-close-button' src='public/close-button.png' onclick='hideInstructions("host-instructions", "information-img")'/>
                        </div>
                        <p id='host-instructions-text'>Hover over or click on a host on the legend to isolate that host on the graph. Click on a selected host to deselect it. or just select a different host on the legend</p>
                    </div>
                    <div class="container legend" id="workflow-execution-chart-legend"></div>
                    <div id="graph-container"></div>
                </div>
            </div>
            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("task-details-table-container", "simulation-details-arrow")'>
                    <h6 class='title-text'>Simulation Details</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='simulation-details-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>

                <div class='hidden' id='task-details-table-container'>
                    <table class="task-details-table" id='task-details-table'>
                        <colgroup>
                            <col span="1"></col>
                            <col span="3" class="read-col"></col>
                            <col span="3" class="compute-col"></col>
                            <col span="3" class="write-col"></col>
                            <col span="1"></col>
                        </colgroup>
                        <thead class="task-details-table">
                            <tr>
                                <td></td>
                                <td colspan="3" class="text-center task-details-table-td">Read Input</td>
                                <td colspan="3" class="text-center task-details-table-td">Computation</td>
                                <td colspan="3" class="text-center task-details-table-td">Write Output</td>
                                <td></td>
                            </tr>
                            <tr>
                                <th scope="col" class="task-details-table-header">TaskID</th>
                                <th scope="col" class="task-details-table-header">Start Time</th>
                                <th scope="col" class="task-details-table-header">End Time</th>
                                <th scope="col" class="task-details-table-header">Duration</th>
                                <th scope="col" class="task-details-table-header">Start Time</th>
                                <th scope="col" class="task-details-table-header">End Time</th>
                                <th scope="col" class="task-details-table-header">Duration</th>
                                <th scope="col" class="task-details-table-header">Start Time</th>
                                <th scope="col" class="task-details-table-header">End Time</th>
                                <th scope="col" class="task-details-table-header">Duration</th>
                                <th scope="col" class="task-details-table-header">Task Duration</th>
                            </tr>
                        </thead>

                        <tbody class="task-details-table" id="task-details-table-body">

                        </tbody>
                    </table>
                </div>

            </div>

            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("energy-graph", "energy-graph-arrow")'>
                    <h6 class='title-text'>Energy Graphs</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='energy-graph-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>

                <div class='hidden' id='energy-graph' style="padding: 10px">
                    <!-- Markup -->
                    <b><p style="align-content: center">Consumed Energy Graph</p></b>
                    <div id="consumedEnergyGraph" style="margin: 10px"></div>
                    <div id="consumedEnergyGraphLegend" style="margin-left: 35px; margin-bottom: 10px"></div>

                    <b><p style="align-content: center">Power State Graph</p></b>
                    <div id="pStateGraph" style="margin: 20px"></div>
                    <div id="pStateGraphLegend" style="margin-left: 35px"></div>
                    
                </div>

            </div>

            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("three-d-graph-container", "three-d-graph-arrow")'>
                    <h6 class='title-text'>3D Visualisation</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='three-d-graph-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>
                <div id='three-d-graph-container' class='hidden'>
                    <img id='three-d-information-img' class='information-img' src='public/information.png' onclick='showInstructions("three-d-instructions", "three-d-information-img")'/>
                    <div id='three-d-instructions' class='instructions-container' style='text-align: left'>
                        <div id='three-d-instructions-close-button-container' class='instructions-close-button-container'>
                            <img id='three-d-instructions-close-button' class='instructions-close-button' src='public/close-button.png' onclick='hideInstructions("three-d-instructions", "three-d-information-img")'/>
                        </div>
                        <p id='three-d-instructions-text'>
                            Each cube in this 3D graph represents a task. The color to task ID mapping can be found in the legend below. Hover over or click a task in the legend to view more details about the task and highlight it in the graph. You can click and drag the graph to adjust the angle. 
                        </p>
                        <p>
                            Use these configurations to change how you view the graph:
                        </p>
                        <ul>
                            <li>Origin: change where the origin is on the page</li>
                            <li>Time interval: adjust how much time a square on the grid represents</li>
                            <li>Scale: alter the size of of the squares</li>
                        </ul>
                    </div>
                    <div id='three-d-graph-config'>
                        <div id='three-d-origin' class='three-d-graph-config'>
                            Origin:<br>
                            X: <input type='number' id='origin-x'>
                            Y: <input type='number' id='origin-y'>
                        </div>
                        <div id='time-interval-container' class='three-d-graph-config'>
                            Time interval: <br>
                            <input type='number' id='time-interval' step='10'> <br>
                        </div>
                        <div id='scale-input-container' class='three-d-graph-config'>
                            Scale: <br><input type='number' id='scale-input'>
                        </div>
                    </div>
                    <p>Legend:</p>
                    <div class="container legend" id="three-d-legend"></div>
                    <div class="text-left" id="three-d-tooltip-container">
                        <span id="three-d-tooltip-task-id"></span><br>
                        <span id="three-d-tooltip-host"></span><br>
                        <span id="three-d-tooltip-task-operation-duration"></span>
                    </div>
                    <svg width="100%" height="1000px" id='three-d-graph-svg'></svg>
                </div>
            </div>

            <div class='element-and-title-container'>
                <div class='title-container' onclick='showHideArrow("host-utilization-graph-container", "host-utilization-arrow")'>
                    <h6 class='title-text'>Host Utilization Graph</h6>
                    <div class='arrow-div'>
                        <span class='arrow-helper'></span>
                        <img id='host-utilization-arrow' class='arrow-img' src='public/expand-arrow.png'/>
                    </div>
                </div>

                <div class='hidden' id='host-utilization-graph-container' style="padding: 10px">
                    <div class="chart" id="host-utilization-chart">

                        <div class="container legend" id="host-utilization-chart-legend">
                            <small class="inline-block" id="host-utilization-chart-legend-compute-time">Compute Time</small>
                            <small class="inline-block" id="host-utilization-chart-legend-idle-time">Idle Time</small>
                        </div>

                        <div class="text-left" id="host-utilization-chart-tooltip">
                            <span id="host-utilization-chart-tooltip-task-id"></span><br>
                            <span id="host-utilization-chart-tooltip-compute-time"></span><br>
                        </div>

                    </div>
                </div>

            </div>

        </div>
    </body>
    <script src="scripts/data.js" ></script>
    <script src="scripts/util.js" ></script>
    <script src="scripts/button-clicks.js"></script>
    <script src="scripts/graph-sections/3d-visualization.js"></script>
    <script src="scripts/graph-sections/energy-graphs.js"></script>
    <script src="scripts/graph-sections/simulation-details.js"></script>
    <script src="scripts/graph-sections/simulation-graph.js"></script>
    <script src="scripts/graph-sections/workflow-summary.js"></script>
    <script src="scripts/graph-sections/host-utilization.js"></script>
    <script src="scripts/initialise.js"></script>
</html>