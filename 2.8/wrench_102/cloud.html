

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interacting with a cloud compute service &mdash; WRENCH 2.8 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=8b628ae0" />

  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=4348de45"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/wrench-dark-theme-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing WRENCH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../simulation_101.html">Simulation 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrench_101.html">WRENCH 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wrench_102.html">WRENCH 102</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_user.html">WRENCH User C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_developer.html">WRENCH Developer C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_internal.html">WRENCH Internal C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rest_api.html">WRENCH REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_api.html">WRENCH Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WRENCH</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Interacting with a cloud compute service</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/wrench_102/cloud.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interacting-with-a-cloud-compute-service">
<span id="guide-102-cloud"></span><h1>Interacting with a cloud compute service<a class="headerlink" href="#interacting-with-a-cloud-compute-service" title="Link to this heading"></a></h1>
<p>A cloud service provides mechanisms to manage the set of VMs
instantiated on hardware resources. Each VM instance, while it’s
running, exposes its own bare-metal compute service to which <a class="reference internal" href="baremetal.html#guide-102-baremetal"><span class="std std-ref">standard
jobs can be submitted</span></a>. As a result, one
never submits a job directly to a cloud service.</p>
<p>It is possible to create, shutdown, start, suspend, and resume VMs (see
a complete list of functions available in the
<a class="reference internal" href="../api_developer/classwrench_1_1_cloud_compute_service.html#_CPPv4N6wrench19CloudComputeServiceE" title="wrench::CloudComputeService"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">wrench::CloudComputeService</span></code></a> API documentation). The figure below
shows the state transition diagram of a VM instance:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/wrench-guide-cloud-state-diagram.png"><img alt="../_images/wrench-guide-cloud-state-diagram.png" src="../_images/wrench-guide-cloud-state-diagram.png" style="width: 338.0px; height: 238.0px;" />
</a>
</figure>
<p>Here is an example interaction with a <a class="reference internal" href="../api_developer/classwrench_1_1_cloud_compute_service.html#_CPPv4N6wrench19CloudComputeServiceE" title="wrench::CloudComputeService"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">wrench::CloudComputeService</span></code></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="nl">std</span><span class="p">:</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">wrench</span><span class="o">::</span><span class="n">CloudComputeService</span><span class="o">&gt;</span><span class="w"> </span><span class="n">some_cloud_cs</span><span class="p">;</span>

<span class="c1">// Create a VM with 2 cores and 1 GiB of RAM, which could fail if</span>
<span class="c1">// not enough resources are available</span>
<span class="k">auto</span><span class="w"> </span><span class="n">vm1_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">createVM</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">30</span><span class="p">));</span>

<span class="c1">// Create a VM with 4 cores and 2 GiB of RAM, which could fail if</span>
<span class="c1">// not enough resources are available</span>
<span class="k">auto</span><span class="w"> </span><span class="n">vm2_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">createVM</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">31</span><span class="p">));</span>

<span class="c1">// Start both VMs and keep track of their associated bare-metal compute services</span>
<span class="k">auto</span><span class="w"> </span><span class="n">vm1_cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">startVM</span><span class="p">(</span><span class="n">vm1_name</span><span class="p">);</span>
<span class="k">auto</span><span class="w"> </span><span class="n">vm2_cs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">startVM</span><span class="p">(</span><span class="n">vm2_name</span><span class="p">);</span>

<span class="c1">// Create a job manager</span>
<span class="k">auto</span><span class="w"> </span><span class="n">job_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">createJobManager</span><span class="p">();</span>

<span class="c1">// Create a job</span>
<span class="k">auto</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">job_manager</span><span class="o">-&gt;</span><span class="n">createStandardJob</span><span class="p">({...</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="p">...});</span>

<span class="c1">// Submit the job to the 1st VM (i.e., to its bare-metal compute service)</span>
<span class="n">job_manager</span><span class="o">-&gt;</span><span class="n">submitJob</span><span class="p">(</span><span class="n">job</span><span class="p">,</span><span class="w"> </span><span class="n">vm1_cs</span><span class="p">);</span>

<span class="c1">// Sleep for 10 seconds</span>
<span class="n">Simulation</span><span class="o">::</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// Suspend the 1st VM</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">suspendVM</span><span class="p">(</span><span class="n">vm1_name</span><span class="p">);</span>
<span class="c1">// Sleep for 10 seconds</span>
<span class="n">Simulation</span><span class="o">::</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

<span class="c1">// Resume the 1st VM</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">resumeVM</span><span class="p">(</span><span class="n">vm1_name</span><span class="p">);</span>
<span class="c1">// Wait for and process the next event (should be a standard job completion or failure)</span>
<span class="k">this</span><span class="o">-&gt;</span><span class="n">waitForAndProcessNextEvent</span><span class="p">();</span>

<span class="c1">// Shutdown both VMs</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">shutdownVM</span><span class="p">(</span><span class="n">vm1_name</span><span class="p">);</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">shutdownVM</span><span class="p">(</span><span class="n">vm2_name</span><span class="p">);</span>

<span class="c1">// Destroy both VMs, which releases resources</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">destroyVM</span><span class="p">(</span><span class="n">vm1_name</span><span class="p">);</span>
<span class="n">some_cloud_cs</span><span class="o">-&gt;</span><span class="n">destroyVM</span><span class="p">(</span><span class="n">vm2_name</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that the cloud service will decide on which physical resources VM
instances should be created. The underlying physical resources are
completely hidden by the cloud service abstraction. If you want more
control over how the physical resources are used you likely need a
<a class="reference internal" href="virtualizedcluster.html#guide-102-virtualizedcluster"><span class="std std-ref">virtualized cluster services</span></a>.</p>
<p>See the execution controller implementation in
<code class="docutils literal notranslate"><span class="pre">examples/workflow_api/basic-examples/cloud-bag-of-tasks/TwoTasksAtATimeCloudWMS.cpp</span></code>
for a more complete example.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, WRENCH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>